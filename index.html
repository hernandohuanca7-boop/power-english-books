<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POWER ENGLISH PRONUNCIATION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            background-color: #f0f9ff; 
            background-image: linear-gradient(rgba(240, 249, 255, 0.94), rgba(240, 249, 255, 0.94)), url('logo-libros.PNG');
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: 70% auto;
        } 
        #wordFeedback { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; word-break: break-word; }
        .word-correct { color: #10b981; font-weight: bold; }
        .word-incorrect { color: #ef4444; font-weight: bold; text-decoration: underline; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .recording-active { animation: pulse-red 1.5s infinite; background-color: #dc2626 !important; }
        .bot-icon { font-size: 3.5rem; }
        /* Estilo para el SÃ­mbolo del DÃ­a */
        .ipa-badge { background: #dbeafe; color: #1e40af; padding: 2px 8px; rounded: 8px; font-family: 'serif'; font-weight: bold; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 font-sans">

    <header class="w-full max-w-2xl flex flex-col items-center mb-6 mt-4 z-10">
        <div class="bg-white p-3 rounded-3xl mb-4 shadow-lg border border-blue-100">
            <img id="bookLogo" src="logo-libros.PNG" alt="Logo" class="h-20 w-20 object-contain rounded-2xl">
        </div>
        <h1 class="text-2xl md:text-3xl font-black text-slate-700 tracking-tight text-center uppercase">
            POWER ENGLISH <span class="text-blue-500">PRONUNCIATION</span>
        </h1>
    </header>

    <main class="w-full max-w-2xl bg-white/90 backdrop-blur-sm rounded-[3rem] shadow-2xl p-6 md:p-10 space-y-6 border border-white z-10">
        
        <div id="dailyPhoneme" class="bg-blue-600 text-white p-4 rounded-2xl shadow-md flex items-center justify-between">
            <div>
                <p class="text-[9px] font-black uppercase tracking-tighter opacity-80">Phoneme of the Day</p>
                <p id="phonemeText" class="text-lg font-medium italic">Cargando fonema...</p>
            </div>
            <div id="phonemeSymbol" class="text-3xl font-serif bg-white/20 w-12 h-12 flex items-center justify-center rounded-full"></div>
        </div>

        <section>
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 ml-2">Selecciona tu EXERCISE:</label>
            <select id="phraseSelector" class="w-full p-4 text-base md:text-lg font-bold border-2 border-blue-50 rounded-2xl bg-white focus:border-blue-300 outline-none shadow-sm italic text-slate-600 appearance-none"></select>
        </section>

        <section class="bg-slate-800 rounded-[2.5rem] p-6 md:p-10 text-center shadow-2xl relative">
            <p id="targetPhrase" class="text-xl md:text-3xl font-medium text-white leading-relaxed mb-8 italic px-2"></p>
            <div class="flex flex-wrap justify-center gap-3">
                <button onclick="playModel(1)" class="flex items-center gap-2 bg-slate-700 text-white px-5 py-3 rounded-xl hover:bg-blue-600 transition-all border border-slate-600">
                    <i class="fas fa-play text-blue-400"></i><span class="text-[10px] font-bold uppercase">Normal</span>
                </button>
                <button onclick="playModel(0.5)" class="flex items-center gap-2 bg-slate-700 text-white px-5 py-3 rounded-xl hover:bg-amber-600 transition-all border border-slate-600">
                    <i class="fas fa-turtle text-amber-400"></i><span class="text-[10px] font-bold uppercase">Lento</span>
                </button>
            </div>
        </section>

        <section id="resultContainer" class="hidden animate-in fade-in zoom-in duration-300">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center bg-blue-50/50 rounded-[2rem] p-6 border border-blue-100 text-center">
                <div class="flex flex-col items-center">
                    <span id="botEmoji" class="bot-icon animate-bounce">ðŸ¤–</span>
                    <p id="fluencyLabel" class="font-black text-blue-800 uppercase text-xs mt-2"></p>
                </div>
                <div class="space-y-1 md:border-l border-blue-200 md:pl-6 text-center">
                    <div class="text-6xl font-black text-blue-600" id="scorePercent">0%</div>
                    <p id="coachAdvice" class="text-sm text-slate-600 font-medium leading-tight px-2"></p>
                </div>
            </div>
            <div id="wordFeedback" class="mt-8 px-2 text-xl md:text-2xl text-center"></div>
        </section>

        <section class="flex flex-col gap-4">
            <button id="btnRecord" onclick="toggleRecording()" class="w-full py-7 md:py-9 rounded-[2.5rem] bg-blue-500 text-white text-2xl md:text-4xl font-black shadow-xl hover:bg-blue-600 active:scale-95 transition-all flex items-center justify-center gap-6">
                <i class="fas fa-microphone" id="micIcon"></i><span id="btnText">Â¡HABLAR!</span>
            </button>
        </section>
    </main>

    <script>
        const contenidoLibros = {
            "1": ["Good morning my friend, how are you?", "She is my teacher, her name is Claudia.", "Hi friend, can you spell your name, please?", "Excuse me, how old are you?", "Hey bro, what is your cell phone number?", "It is my dog, its name is Snoopy.", "Hi, I am from England, I am English, and you?", "This is my English dictionary, these are my five markers.", "My mom is a nurse, she works at the hospital and she is 37 years old.", "My name is Power English Bot, I am your AI personal assistant."],
            "2": ["The show must go on, go ahead, make your day, put on a happy face, don't put off until tomorrow what you can do today.", "Peter Piper picked a peck of pickled peppers.", "I will practice football at four o'clock, she has English classes on Mondays.", "Where is located the bakery? The bakery in on the corner of Main street and Summer Street.", "She sells seashells by the seashore.", "Apple: Vitamins and minerals, most popular fruit around the world the apple has fiber, C vitamin and various antioxidants, low in calories counting, apples also are used in recipes, juices and drinks.", "I always study after class, my sister usually gets good scores and she occasionally goes to bed late.", "Technology offers us many conveniences that contribute to a more peaceful life.", "You held me down, but I got up, already brushing off the dust, you hear my voice, your hear that sound like thunder, gonna shake your ground.", "Today, Abby is visiting her grandparents. She loves her grandparents. At this moment, she is sitting on her grandfather's knee. She is listening to a story."]
        };

        const phonemes = [
            { s: "Î¸", d: "Pon la lengua entre los dientes (TH). Ej: 'Thunder'" },
            { s: "Êƒ", d: "Sonido de pedir silencio (SH). Ej: 'She'" },
            { s: "tÊƒ", d: "Como una 'ch' seca. Ej: 'Teacher'" },
            { s: "Ã¦", d: "Vocal entre 'a' y 'e'. Ej: 'Apple'" },
            { s: "É™", d: "Sonido Schwa, muy relajado. Ej: 'Teacher' (final)" }
        ];

        const phoneticTips = {
            "teacher": "Fallaste en: $/ËˆtiËtÊƒÉ™(r)/$. Tip: La 'ch' es seca.",
            "spell": "Fallaste en: $/spel/$. Tip: No digas 'Espell', empieza con Sss.",
            "peppers": "Fallaste en: $/ËˆpepÉ™(r)z/$. Tip: La P debe explotar con aire.",
            "thunder": "Fallaste en: $/ËˆÎ¸ÊŒndÉ™(r)/$. Tip: Usa el fonema $/Î¸/$ (lengua en dientes).",
            "english": "Fallaste en: $/ËˆÉªÅ‹É¡lÉªÊƒ/$. Tip: La SH $/Êƒ/$ es larga.",
            "apple": "Fallaste en: $/ËˆÃ¦pl/$. Tip: Usa la vocal $/Ã¦/$."
        };

        let recognition, isRecording = false, startTime;

        window.addEventListener('DOMContentLoaded', () => {
            const randomPhoneme = phonemes[Math.floor(Math.random() * phonemes.length)];
            document.getElementById('phonemeSymbol').innerText = randomPhoneme.s;
            document.getElementById('phonemeText').innerText = randomPhoneme.d;

            const params = new URLSearchParams(window.location.search);
            const libroId = params.get('libro') || "1"; 
            const frases = contenidoLibros[libroId] || contenidoLibros["1"];
            const selector = document.getElementById('phraseSelector');
            frases.forEach((f, i) => {
                const opt = document.createElement('option');
                opt.value = f; opt.textContent = `EXERCISE ${i+1}`; selector.appendChild(opt);
            });
            document.getElementById('targetPhrase').innerText = selector.value;
            selector.onchange = () => { document.getElementById('targetPhrase').innerText = selector.value; document.getElementById('resultContainer').classList.add('hidden'); };
            setupSpeech();
        });

        function setupSpeech() {
            if (!('webkitSpeechRecognition' in window)) return;
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US';
            recognition.onstart = () => { isRecording = true; startTime = Date.now(); document.getElementById('btnText').innerText = "ESCUCHANDO..."; document.getElementById('btnRecord').classList.add('recording-active'); };
            recognition.onresult = (e) => { evaluate(e.results[0][0].transcript, (Date.now() - startTime) / 1000); };
            recognition.onend = () => { isRecording = false; document.getElementById('btnText').innerText = "Â¡HABLAR!"; document.getElementById('btnRecord').classList.remove('recording-active'); };
        }

        function toggleRecording() { if (isRecording) recognition.stop(); else { document.getElementById('resultContainer').classList.add('hidden'); recognition.start(); } }

        function evaluate(spoken, duration) {
            const targetWords = document.getElementById('targetPhrase').innerText.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").split(/\s+/);
            const spokenWords = spoken.toLowerCase().split(/\s+/);
            let correct = 0, feedbackHTML = "", specificTip = "Â¡Great effort!";

            targetWords.forEach(word => {
                if (spokenWords.includes(word)) { feedbackHTML += `<span class="word-correct">${word}</span>`; correct++; }
                else { 
                    feedbackHTML += `<span class="word-incorrect">${word}</span>`;
                    if (phoneticTips[word]) specificTip = phoneticTips[word];
                }
            });

            const percent = Math.round((correct / targetWords.length) * 100);
            const botEmoji = document.getElementById('botEmoji');
            botEmoji.innerText = percent >= 90 ? "ðŸš€" : (percent >= 70 ? "ðŸ¤–" : "âš™ï¸");
            
            document.getElementById('scorePercent').innerText = percent + "%";
            document.getElementById('wordFeedback').innerHTML = feedbackHTML;
            document.getElementById('coachAdvice').innerText = specificTip;
            document.getElementById('fluencyLabel').innerText = percent >= 90 ? "Excellent!" : "Keep it up!";
            document.getElementById('resultContainer').classList.remove('hidden');
        }

        function playModel(speed) { window.speechSynthesis.cancel(); const msg = new SpeechSynthesisUtterance(document.getElementById('targetPhrase').innerText); msg.lang = 'en-US'; msg.rate = speed; window.speechSynthesis.speak(msg); }
    </script>
</body>
</html>
