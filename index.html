<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POWER ENGLISH PRONUNCIATION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* FONDO CON LOGO M√ÅS VISIBLE */
        body { 
            background-color: #f0f9ff; 
            background-image: linear-gradient(rgba(240, 249, 255, 0.85), rgba(240, 249, 255, 0.85)), url('logo-libros.PNG');
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: 80% auto; /* Un poco m√°s grande para que resalte */
        } 
        
        #wordFeedback {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            word-break: break-word;
            margin-top: 2rem;
        }

        .word-box { display: inline-flex; flex-direction: column; align-items: center; }
        .word-correct { color: #10b981; font-weight: bold; font-size: 1.2rem; }
        
        /* ERROR GIGANTE Y POTENTE */
        .word-incorrect { 
            color: #ef4444; 
            font-weight: 900; 
            font-size: 3rem; /* Aumentado para m√°ximo impacto */
            text-decoration: underline; 
            line-height: 1; 
            text-transform: lowercase;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .ipa-error { 
            color: #b91c1c; 
            font-size: 1.6rem; 
            font-family: 'serif'; 
            font-weight: bold;
            margin-top: 5px; 
            background: #fee2e2; 
            padding: 4px 15px; 
            border-radius: 12px; 
            border: 2px solid #fecaca;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .recording-active { animation: pulse-red 1.5s infinite; background-color: #dc2626 !important; }
        .bot-icon { font-size: 3.5rem; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 font-sans">

    <header class="w-full max-w-2xl flex flex-col items-center mb-6 mt-4 z-10">
        <div class="bg-white p-3 rounded-3xl mb-4 shadow-lg border border-blue-100">
            <img id="bookLogo" src="logo-libros.PNG" alt="Logo" class="h-20 w-20 object-contain rounded-2xl">
        </div>
        <h1 class="text-2xl md:text-3xl font-black text-slate-700 tracking-tight text-center uppercase">
            POWER ENGLISH <span class="text-blue-500">PRONUNCIATION</span>
        </h1>
    </header>

    <main class="w-full max-w-2xl bg-white/95 backdrop-blur-sm rounded-[3rem] shadow-2xl p-6 md:p-10 space-y-6 border border-white z-10">
        
        <div id="dailyPhoneme" class="bg-blue-600 text-white p-4 rounded-2xl shadow-md flex items-center justify-between border-b-4 border-blue-800">
            <div>
                <p class="text-[9px] font-black uppercase tracking-tighter opacity-80">Phoneme of the Day</p>
                <p id="phonemeText" class="text-sm font-medium italic">Cargando...</p>
            </div>
            <div id="phonemeSymbol" class="text-3xl font-serif bg-white/20 w-12 h-12 flex items-center justify-center rounded-full border border-white/30"></div>
        </div>

        <section>
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 ml-2">Selecciona tu EXERCISE:</label>
            <select id="phraseSelector" class="w-full p-4 text-base md:text-lg font-bold border-2 border-blue-50 rounded-2xl bg-white focus:border-blue-300 outline-none shadow-sm italic text-slate-600 appearance-none"></select>
        </section>

        <section class="bg-slate-800 rounded-[2.5rem] p-6 md:p-10 text-center shadow-2xl relative">
            <p id="targetPhrase" class="text-xl md:text-3xl font-medium text-white leading-relaxed mb-8 italic px-2"></p>
            <div class="flex flex-wrap justify-center gap-3">
                <button onclick="playModel(1)" class="flex items-center gap-2 bg-slate-700 text-white px-5 py-3 rounded-xl hover:bg-blue-600 transition-all border border-slate-600">
                    <i class="fas fa-play text-blue-400"></i><span class="text-[10px] font-bold uppercase">Normal</span>
                </button>
                <button onclick="playModel(0.5)" class="flex items-center gap-2 bg-slate-700 text-white px-5 py-3 rounded-xl hover:bg-amber-600 transition-all border border-slate-600">
                    <i class="fas fa-turtle text-amber-400"></i><span class="text-[10px] font-bold uppercase">Lento</span>
                </button>
            </div>
        </section>

        <section id="resultContainer" class="hidden animate-in fade-in zoom-in duration-300">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center bg-blue-50/50 rounded-[2rem] p-6 border border-blue-100 text-center">
                <div class="flex flex-col items-center">
                    <span id="botEmoji" class="bot-icon animate-bounce">ü§ñ</span>
                    <p id="fluencyLabel" class="font-black text-blue-800 uppercase text-xs mt-2"></p>
                </div>
                <div class="space-y-1 md:border-l border-blue-200 md:pl-6 text-center">
                    <div class="text-6xl font-black text-blue-600" id="scorePercent">0%</div>
                    <p id="coachAdvice" class="text-sm text-slate-600 font-medium leading-tight px-2 italic"></p>
                </div>
            </div>
            <div id="wordFeedback"></div>
        </section>

        <section class="flex flex-col gap-4">
            <button id="btnRecord" onclick="toggleRecording()" class="w-full py-7 md:py-9 rounded-[2.5rem] bg-blue-500 text-white text-2xl md:text-4xl font-black shadow-xl shadow-blue-200 hover:bg-blue-600 active:scale-95 transition-all flex items-center justify-center gap-6">
                <i class="fas fa-microphone" id="micIcon"></i><span id="btnText">¬°HABLAR!</span>
            </button>
        </section>
    </main>

    <footer class="mt-8 text-slate-400 font-bold text-[10px] uppercase tracking-widest pb-8 text-center">
        ¬© 2026 Power English Bot - AI Phonetic Coach
    </footer>

    <script>
        const contenidoLibros = {
            "1": ["Good morning my friend, how are you?", "She is my teacher, her name is Claudia.", "Hi friend, can you spell your name, please?", "Excuse me, how old are you?", "Hey bro, what is your cell phone number?", "It is my dog, its name is Snoopy.", "Hi, I am from England, I am English, and you?", "This is my English dictionary, these are my five markers.", "My mom is a nurse, she works at the hospital and she is 37 years old.", "My name is Power English Bot, I am your AI personal assistant."],
            "2": ["The show must go on, go ahead, make your day, put on a happy face, don't put off until tomorrow what you can do today.", "Peter Piper picked a peck of pickled peppers.", "I will practice football at four o'clock, she has English classes on Mondays.", "Where is located the bakery? The bakery in on the corner of Main street and Summer Street.", "She sells seashells by the seashore.", "Apple: Vitamins and minerals, most popular fruit around the world the apple has fiber, C vitamin and various antioxidants, low in calories counting, apples also are used in recipes, juices and drinks.", "I always study after class, my sister usually gets good scores and she occasionally goes to bed late.", "Technology offers us many conveniences that contribute to a more peaceful life.", "You held me down, but I got up, already brushing off the dust, you hear my voice, your hear that sound like thunder, gonna shake your ground.", "Today, Abby is visiting her grandparents. She loves her grandparents. At this moment, she is sitting on her grandfather's knee. She is listening to a story."]
        };

        const phonemes = [
            { s: "Œ∏", d: "Pon la lengua entre los dientes (TH). Ej: 'Thunder'" },
            { s: " É", d: "Sonido de pedir silencio (SH). Ej: 'She'" },
            { s: "t É", d: "Como una 'ch' seca. Ej: 'Teacher'" },
            { s: "√¶", d: "Vocal entre 'a' y 'e'. Ej: 'Apple'" },
            { s: "…ô", d: "Sonido Schwa, muy relajado. Ej: 'Teacher' (final)" }
        ];

        const phoneticTips = {
            "teacher": "/ÀàtiÀêt É…ô(r)/", "spell": "/spel/", "peppers": "/Ààpep…ô(r)z/", "thunder": "/ÀàŒ∏ ånd…ô(r)/",
            "english": "/Àà…™≈ã…°l…™ É/", "apple": "/Àà√¶pl/", "seashells": "/ÀàsiÀê Éelz/", "seashore": "/ÀàsiÀê É…îÀê(r)/",
            "bakery": "/Ààbe…™k…ôri/", "tomorrow": "/t…ôÀàm…ír…ô ä/"
        };

        let recognition, isRecording = false, startTime;

        window.addEventListener('DOMContentLoaded', () => {
            const randomPhoneme = phonemes[Math.floor(Math.random() * phonemes.length)];
            document.getElementById('phonemeSymbol').innerText = randomPhoneme.s;
            document.getElementById('phonemeText').innerText = randomPhoneme.d;

            const params = new URLSearchParams(window.location.search);
            const libroId = params.get('libro') || "1"; 
            const frases = contenidoLibros[libroId] || contenidoLibros["1"];
            const selector = document.getElementById('phraseSelector');
            frases.forEach((f, i) => {
                const opt = document.createElement('option');
                opt.value = f; opt.textContent = `EXERCISE ${i+1}`; selector.appendChild(opt);
            });
            document.getElementById('targetPhrase').innerText = selector.value;
            selector.onchange = () => { document.getElementById('targetPhrase').innerText = selector.value; document.getElementById('resultContainer').classList.add('hidden'); };
            setupSpeech();
        });

        function setupSpeech() {
            if (!('webkitSpeechRecognition' in window)) return;
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US';
            recognition.onstart = () => { isRecording = true; startTime = Date.now(); document.getElementById('btnText').innerText = "ESCUCHANDO..."; document.getElementById('btnRecord').classList.add('recording-active'); };
            recognition.onresult = (e) => { evaluate(e.results[0][0].transcript, (Date.now() - startTime) / 1000); };
            recognition.onend = () => { isRecording = false; document.getElementById('btnText').innerText = "¬°HABLAR!"; document.getElementById('btnRecord').classList.remove('recording-active'); };
        }

        function toggleRecording() { if (isRecording) recognition.stop(); else { document.getElementById('resultContainer').classList.add('hidden'); recognition.start(); } }

        function evaluate(spoken, duration) {
            const targetWords = document.getElementById('targetPhrase').innerText.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").split(/\s+/);
            const spokenWords = spoken.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").split(/\s+/);
            let correct = 0, feedbackHTML = "", foundError = false;

            targetWords.forEach(word => {
                const ipa = phoneticTips[word] || "";
                if (spokenWords.includes(word)) {
                    feedbackHTML += `<div class="word-box"><span class="word-correct">${word}</span></div>`;
                    correct++;
                } else {
                    feedbackHTML += `<div class="word-box"><span class="word-incorrect">${word}</span>${ipa ? `<span class="ipa-error">${ipa}</span>` : ''}</div>`;
                    foundError = true;
                }
            });

            const percent = Math.round((correct / targetWords.length) * 100);
            document.getElementById('scorePercent').innerText = percent + "%";
            document.getElementById('wordFeedback').innerHTML = feedbackHTML;
            document.getElementById('coachAdvice').innerText = foundError ? "Pay attention to the red words and symbols." : "Perfect pronunciation! You're a pro.";
            const botEmoji = document.getElementById('botEmoji');
            botEmoji.innerText = percent >= 90 ? "üöÄ" : (percent >= 70 ? "ü§ñ" : "‚öôÔ∏è");
            document.getElementById('resultContainer').classList.remove('hidden');
        }

        function playModel(speed) { 
            window.speechSynthesis.cancel(); 
            const msg = new SpeechSynthesisUtterance(document.getElementById('targetPhrase').innerText); 
            msg.lang = 'en-US'; msg.rate = speed; window.speechSynthesis.speak(msg); 
        }
    </script>
</body>
</html>
